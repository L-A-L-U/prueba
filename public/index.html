<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laundry Check</title> 
    <link rel="icon" href="data:,">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { --bg:#f4f6f8; --side:#1a1d21; --accent:#3b82f6; --text:#212529; --card:#ffffff; --border:#e0e0e0; }
        body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); height:100vh; overflow:hidden; margin: 0; }
        .app { display:flex; height:100%; width: 100%; position: relative; }
        .sidebar { width:260px; min-width: 260px; background:var(--side); color:#adb5bd; display:flex; flex-direction:column; padding:20px 15px; height: 100%; transition: transform 0.3s ease; z-index: 2000; overflow-y: auto; }
        .nav-item { display:flex; align-items:center; gap:12px; padding:12px 15px; border-radius:8px; cursor:pointer; margin-bottom:5px; transition: 0.2s; font-weight: 500; }
        .nav-item:hover { background: rgba(255,255,255,0.08); color: white; }
        .nav-item.active { background:var(--accent); color:white; font-weight: 700; box-shadow: 0 4px 6px rgba(0,0,0,0.2); } 
        .main { flex:1; background:var(--bg); overflow:hidden; display: flex; flex-direction: column; position: relative; width: 100%; }
        .view { display:none; height:100%; overflow-y:auto; padding:20px; padding-bottom: 80px; -webkit-overflow-scrolling: touch; } 
        .view.active { display:block; }
        .pos-container { display: flex; gap: 20px; height: 100%; }
        .pos-left { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .pos-right { width: 350px; min-width: 350px; display: flex; flex-direction: column; background: var(--card); border-radius: 12px; border: 1px solid var(--border); height: 100%; overflow: hidden; }
        .top-btns-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        @media (min-width: 901px) { .top-btns-grid { grid-template-columns: 1fr 1fr 1fr 1fr; } }
        .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:12px; overflow-y: auto; padding-bottom: 20px; }
        .prod { border:1px solid var(--border); border-radius:12px; padding:15px; text-align:center; cursor:pointer; background:var(--card); transition: 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px; }
        .prod:active { transform: scale(0.95); border-color: var(--accent); }
        .prod i { font-size: 2rem; margin-bottom: 5px; color: var(--accent); }
        .ticket-body { flex: 1; overflow-y: auto; padding: 15px; background: #fff; }
        .kpi-card { background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 15px; height: 100%; border-left: 4px solid var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .delivery-card { background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .delivery-header { padding: 12px 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .delivery-body { padding: 15px; font-size: 0.9rem; }
        .delivery-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 10px; background: #f8f9fa; border-top: 1px solid var(--border); }
        .act-btn { text-align: center; padding: 10px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 4px; border: 1px solid transparent; transition: 0.2s; color: inherit; }
        .act-call { background: #e0f2fe; color: #0284c7; }
        .act-map { background: #ffedd5; color: #ea580c; }
        .act-wsp { background: #dcfce7; color: #16a34a; }
        .mobile-menu-btn { display: none; position: absolute; top: 15px; left: 15px; z-index: 3000; background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1500; }
        .sidebar.show + .overlay { display: block; }
        
        #tblAudit td { white-space: normal !important; word-wrap: break-word !important; word-break: break-word !important; vertical-align: top; padding: 8px; font-size: 0.85rem; }
        
        .brand-header { margin-top: 20px; }

        @media (max-width: 900px) {
            .sidebar { position: fixed; left: 0; top: 0; bottom: 0; transform: translateX(-100%); box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
            .sidebar.show { transform: translateX(0); } 
            .mobile-menu-btn { display: block; }
            .main { width: 100%; border-radius: 0; margin: 0; }
            .view { padding: 15px; padding-top: 70px; }
            .pos-container { flex-direction: column; height: auto; overflow: visible; }
            .pos-left { height: auto; min-height: auto; flex: none; order: 1; overflow: visible; }
            .pos-right { width: 100%; min-width: 100%; height: auto; min-height: 400px; margin-bottom: 80px; order: 2; }
            .grid { grid-template-columns: repeat(2, 1fr); gap: 8px; max-height: 400px; }
            .prod { padding: 10px; min-height: 90px; }
            .top-btns-grid { grid-template-columns: 1fr 1fr; }
            
            .brand-header { margin-top: 60px !important; }
        }
        
        #printableTicket { display: none; }
        @media print {
            body { background: white; height: auto; overflow: visible; }
            .app, .mobile-menu-btn, .modal, .swal2-container, .swal2-shown { display: none !important; }
            #printableTicket, #printableTicket * { display: block !important; visibility: visible !important; }
            #printableTicket { position: absolute; left: 0; top: 0; width: 100%; background: white; color: black; font-family: 'Courier New', monospace; z-index: 99999; }
            .ticket-page { width: 100%; margin-bottom: 20px; border-bottom: 1px dashed #ccc; }
            @page { margin: 0; size: auto; }
        }
        .edit-mode-banner { background: #ffc107; color: #000; padding: 5px; text-align: center; font-weight: bold; font-size: 0.8rem; display: none; }
    </style>
</head>
<body>

<button class="mobile-menu-btn no-print" onclick="window.toggleMenu()"><i class="bi bi-list fs-3"></i></button>
<div class="overlay" onclick="window.toggleMenu()"></div>
<div id="printableTicket"></div>

<div class="app">
    <nav class="sidebar no-print">
        <div class="brand-header d-flex align-items-center gap-3 mb-5 px-2 text-white">
            <span class="fw-bold fs-4 tracking-tight">Laundry Check</span>
        </div>

        <div class="px-2 mb-4">
            <div id="avT" class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold shadow-sm mb-2" style="width: 40px; height: 40px;">U</div>
            <div style="line-height: 1.1;"><div id="uName" class="text-white fw-bold">Usuario</div><div id="uRole" class="text-white-50 small">ROL</div></div>
        </div>
        
        <div id="sucursal-selector-container" class="px-2 mb-3" style="display:none;">
            <select id="selSucursal" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="window.cambiarSucursal(this.value)"></select>
        </div>
        
        <div class="px-2 mb-4"><div id="turnoStatus" class="p-2 rounded-2 text-center small fw-bold pointer transition-all" style="background: rgba(255,255,255,0.1); color: #ced4da;">Cargando...</div></div>
        
        <div style="flex:1; overflow-y:auto; padding-right: 5px;">
            <div id="nav-pos" class="nav-item active" onclick="window.nav('pos')"><i class="bi bi-basket2-fill"></i><span>Vender</span></div>
            <div id="nav-search" class="nav-item" onclick="window.nav('search')">
                <i class="bi bi-search"></i><span>B√∫squeda</span>
            </div>
            <div id="nav-rep360" class="nav-item admin-only" onclick="window.nav('rep360')"><i class="bi bi-pie-chart-fill"></i><span>Reporte</span></div>
            <div id="nav-gastos" class="nav-item admin-only" onclick="window.nav('gastos')">
                <i class="bi bi-wallet2"></i><span>Gastos</span>
            </div>
            <div id="nav-kanban" class="nav-item" onclick="window.nav('kanban')"><i class="bi bi-kanban"></i><span>Procesos</span></div>
            <div id="nav-clientes" class="nav-item" onclick="window.nav('clientes')"><i class="bi bi-people"></i><span>Clientes</span></div>
            <div id="nav-chofer" class="nav-item text-warning" onclick="window.nav('chofer')"><i class="bi bi-truck-front-fill"></i><span>Reparto</span></div>
            <div class="admin-only mt-3 pt-3 border-top border-secondary">
                <div id="nav-hist" class="nav-item admin-only" onclick="window.nav('hist')"><i class="bi bi-clock-history"></i><span>Historial</span></div>
                <div id="nav-inv" class="nav-item admin-only" onclick="window.nav('inv')"><i class="bi bi-box-seam"></i><span>Cat√°logo</span></div>
                <div id="nav-users" class="nav-item admin-only" onclick="window.nav('users')"><i class="bi bi-people-fill"></i><span>Equipo</span></div>
                <div id="nav-audit" class="nav-item admin-only text-danger" onclick="window.nav('audit')"><i class="bi bi-shield-check"></i><span>Auditor√≠a</span></div>
                <div id="nav-sucs" class="nav-item admin-only" onclick="window.nav('sucs')"><i class="bi bi-shop-window"></i><span>Sucursales</span></div>
                <div id="nav-conf" class="nav-item admin-only" onclick="window.nav('conf')"><i class="bi bi-gear-fill"></i><span>Configuraci√≥n</span></div>
            </div>
        </div>
        <div class="p-3"><button class="btn btn-outline-danger btn-sm w-100" onclick="window.logout()">Salir</button></div>
    </nav>

    <main class="main">
        <div id="v-pos" class="view active">
            <div class="pos-container">
                <div class="pos-left">
                     <div class="input-group mb-3 shadow-sm rounded-pill overflow-hidden border bg-white">
                        <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-search text-muted"></i></span>
                        <input type="text" id="clientSearch" class="form-control border-0 py-2 fw-bold" placeholder="Buscar Cliente..." oninput="window.handleSearchInput(this)">
                        <button class="btn btn-primary px-4 rounded-pill m-1" onclick="window.modalClient()">+</button>
                     </div>
                     <div id="clientResults" class="position-absolute bg-white border rounded shadow-lg p-0" style="z-index:999;width:90%;top:80px;display:none;max-height:250px;overflow-y:auto;"></div>
                     <div id="selectedClient" class="alert alert-primary d-flex justify-content-between align-items-center p-2 mb-3 shadow-sm" style="display:none;"><div><div class="fw-bold" id="selCliName">--</div><small id="selCliInfo">--</small></div><i class="bi bi-x-circle-fill fs-5 pointer" onclick="window.clearClient()"></i></div>
                     
                     <div class="top-btns-grid">
                        <button class="btn btn-success fw-bold shadow-sm py-3" onclick="window.calcularPesaje()"><i class="bi bi-speedometer2"></i> LAVADO</button>
                        <button class="btn btn-info fw-bold shadow-sm py-3" onclick="window.addGanchos()"><i class="bi bi-paperclip"></i> GANCHOS</button>
                        <button class="btn btn-dark fw-bold shadow-sm py-3" onclick="window.addItemLibre()"><i class="bi bi-pencil"></i> LIBRE</button>
                        <button class="btn btn-warning fw-bold shadow-sm py-3" onclick="window.addDiscount()">% DESC</button>
                     </div>
                     
                     <div class="d-flex justify-content-between mb-2 align-items-center"><h6 class="fw-bold m-0 text-muted">Cat√°logo</h6><input id="search" class="form-control w-50 form-control-sm rounded-pill border" placeholder="Buscar..." onkeyup="window.filt()"></div>
                     <div class="grid" id="grid"></div>
                </div>
                
                <div class="pos-right shadow-sm">
                    <div id="editModeBanner" class="edit-mode-banner">‚ö†Ô∏è MODO EDICI√ìN ‚ö†Ô∏è</div>
                    <div class="p-3 border-bottom d-flex justify-content-between align-items-center bg-light">
                        <h6 class="fw-bold m-0 text-dark">Orden</h6>
                        <span class="badge bg-danger pointer" onclick="window.limpiarCarrito()">LIMPIAR</span>
                    </div>
                    <div id="ticket" class="ticket-body"></div>
                    <div class="p-3 bg-light border-top">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted fw-bold">TOTAL</span>
                            <span class="text-primary fw-bold fs-2" id="total">$0.00</span>
                        </div>
                        <button id="btnPrincipalCobrar" class="btn btn-primary w-100 py-3 fw-bold shadow-sm rounded-3 fs-5" onclick="window.cobrar()">COBRAR</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="v-search" class="view">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <h3 class="fw-bold text-center mb-4">üîç Rastrear Orden</h3>
                    
                    <div class="input-group input-group-lg shadow-sm mb-5">
                        <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-qr-code-scan"></i></span>
                        <input type="text" id="inputBusquedaFolio" class="form-control border-0 fw-bold text-center text-uppercase" placeholder="Folio o Nombre" onkeypress="if(event.key==='Enter') window.buscarOrden()">
                        <button class="btn btn-primary px-4 fw-bold" onclick="window.buscarOrden()">BUSCAR</button>
                    </div>
                </div>
            </div>
        
            <div id="search-result" class="card mt-3 shadow-sm border-0" style="display:none;">
    
                <div id="res-multiple-view" style="display:none;" class="p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold text-muted m-0">üìã Selecciona una orden:</h6>
                        <button class="btn btn-sm btn-outline-secondary" onclick="document.getElementById('search-result').style.display='none'">Cerrar</button>
                    </div>
                    <div id="res-multiple-list" class="list-group"></div>
                </div>
            
                <div id="res-single-view" style="display:none;">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="m-0 fw-bold" id="res-folio">---</h5>
                            <small id="res-cliente" class="text-white opacity-75">---</small>
                        </div>
                        <div id="res-saldo" class="badge bg-light text-dark">---</div>
                    </div>
                    <div class="card-body">
                        <div class="progress mb-2" style="height: 10px;">
                            <div id="res-bar" class="progress-bar bg-secondary" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="d-flex justify-content-between small text-muted mb-3 text-center">
                            <span>Lavando</span><span>Listo</span><span>Entregado</span>
                        </div>
                        <div id="res-status-text" class="alert alert-secondary text-center py-2 fw-bold mb-3">PENDIENTE</div>
            
                        <div class="row">
                            <div class="col-md-7">
                                <h6 class="small fw-bold text-muted">Prendas</h6>
                                <ul class="list-group mb-3 small" id="res-items"></ul>
                            </div>
                            <div class="col-md-5">
                                <h6 class="small fw-bold text-muted">Pagos</h6>
                                <div class="bg-light p-2 rounded mb-2" id="res-historial-pagos"></div>
                                <div class="d-flex justify-content-between fw-bold border-top pt-2">
                                    <span>Total:</span> <span id="res-total">$0.00</span>
                                </div>
                                <div class="d-flex justify-content-between text-success small">
                                    <span>Pagado:</span> <span id="res-pagado">$0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="res-delivery-info" class="mt-3 p-2 bg-success bg-opacity-10 border border-success rounded" style="display:none;">
                            <small class="text-success fw-bold">Entregado por: <span id="res-entregador"></span></small>
                            <br><small class="text-muted" id="res-fecha-ent"></small>
                        </div>
                        <div class="text-end mt-2"><small class="text-muted" id="res-fecha"></small></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="v-gastos" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold"><i class="bi bi-wallet2 text-danger"></i> Control de Gastos</h3>
                <button class="btn btn-danger fw-bold shadow-sm" onclick="window.nuevoGastoModal()">
                    <i class="bi bi-plus-lg"></i> REGISTRAR GASTO
                </button>
            </div>
        
            <div class="card border-0 shadow-sm p-3 mb-3">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="small fw-bold text-muted">Desde</label>
                        <input type="date" id="gasto-ini" class="form-control" onchange="window.loadGastosView()">
                    </div>
                    <div class="col-md-3">
                        <label class="small fw-bold text-muted">Hasta</label>
                        <input type="date" id="gasto-fin" class="form-control" onchange="window.loadGastosView()">
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-dark" onclick="window.printGastosPDF()">
                            <i class="bi bi-file-earmark-pdf"></i> Descargar Reporte
                        </button>
                    </div>
                </div>
        
                <div class="row mt-4 text-center">
                    <div class="col-4 border-end">
                        <small class="text-muted fw-bold">TOTAL GASTADO</small>
                        <h3 class="fw-bold text-dark m-0" id="gasto-total">$0.00</h3>
                    </div>
                    <div class="col-4 border-end">
                        <small class="text-muted fw-bold">CON FACTURA (Deducible)</small>
                        <h3 class="fw-bold text-success m-0" id="gasto-factura">$0.00</h3>
                    </div>
                    <div class="col-4">
                        <small class="text-muted fw-bold">SIN FACTURA</small>
                        <h3 class="fw-bold text-danger m-0" id="gasto-sin">$0.00</h3>
                    </div>
                </div>
            </div>
        
            <div class="card border-0 shadow-sm overflow-hidden">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Fecha</th>
                                <th>Concepto</th>
                                <th>Proveedor</th>
                                <th>Categor√≠a</th>
                                <th class="text-center">Factura</th>
                                <th class="text-end">Monto</th>
                                <th class="text-end">Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tblGastos"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="v-rep360" class="view">
            <h3 class="fw-bold mb-3">Reporte Financiero</h3>
            <div class="card p-3 shadow-sm border-0 mb-3"><div class="row g-2 align-items-end"><div class="col-md-6"><label class="small text-muted">Desde</label><input type="date" id="rep-ini" class="form-control form-control-sm" onchange="window.loadReport360()"></div><div class="col-md-6"><label class="small text-muted">Hasta</label><input type="date" id="rep-fin" class="form-control form-control-sm" onchange="window.loadReport360()"></div></div></div>
            <div class="row g-3 mb-4"><div class="col-6 col-md-3"><div class="kpi-card border-start border-4 border-primary"><small class="text-muted">Ingresos</small><h3 class="fw-bold text-primary m-0" id="kpi-ingresos">$0.00</h3></div></div><div class="col-6 col-md-3"><div class="kpi-card border-start border-4 border-danger"><small class="text-muted">Gastos</small><h3 class="fw-bold text-danger m-0" id="kpi-gastos">$0.00</h3></div></div><div class="col-6 col-md-3"><div class="kpi-card border-start border-4 border-success"><small class="text-muted">Caja</small><h3 class="fw-bold text-success m-0" id="kpi-caja">$0.00</h3></div></div><div class="col-6 col-md-3"><div class="kpi-card border-start border-4 border-warning"><small class="text-muted">Deuda (Periodo)</small><h3 class="fw-bold text-warning m-0" id="kpi-deuda">$0.00</h3></div></div></div>
            <div class="card p-0 shadow-sm border-0 overflow-hidden"><div class="p-3 bg-light border-bottom d-flex justify-content-between align-items-center"><span class="fw-bold small text-muted">MOVIMIENTOS</span><div><button class="btn btn-sm btn-outline-danger" onclick="window.gasto()">- Gasto</button> <button class="btn btn-sm btn-info text-white" onclick="window.exportContadoraPDF()">üìä Reporte SAT</button> <button class="btn btn-sm btn-dark" onclick="window.exportSmartPDF()">PDF</button></div></div>
                <div style="max-height: 50vh; overflow-y: auto;">
                    <table class="table table-hover align-middle mb-0 small">
                        <thead class="table-light sticky-header"><tr><th>Fecha</th><th>Folio</th><th>Cliente</th><th>Metodo</th><th class="text-end">Total Nota</th><th class="text-end">Abono (Hoy)</th><th class="text-end">Deuda</th></tr></thead>
                        <tbody id="tbl-reporte-360"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="v-chofer" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold m-0">Ruta de Reparto</h3>
                <button class="btn btn-light shadow-sm rounded-circle" onclick="window.loadChoferView()">‚Üª</button>
            </div>
            
            <div class="card p-3 mb-3 shadow-sm border-0">
                <div class="row g-2">
                    <div class="col-6">
                        <label class="small fw-bold text-muted">Ver:</label>
                        <select id="choferFiltroEstado" class="form-select" onchange="window.loadChoferView()">
                            <option value="pendientes" selected>‚ö†Ô∏è Pendientes</option>
                            <option value="entregados">‚úÖ Entregados</option>
                            <option value="todos">Todo</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold text-muted">Fecha:</label>
                        <input type="date" id="choferFecha" class="form-control" onchange="window.loadChoferView()">
                    </div>
                </div>
            </div>
        
            <div id="choferCards" class="pb-5"></div>
        </div>

        <div id="v-clientes" class="view"><div class="d-flex justify-content-between mb-4"><h3 class="fw-bold">Clientes</h3><button class="btn btn-primary" onclick="window.modalClient()">+ Nuevo</button></div><div class="table-responsive border rounded bg-white"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Nombre</th><th>Tel√©fono</th><th>Direcci√≥n</th><th>Acci√≥n</th></tr></thead><tbody id="tblClientes"></tbody></table></div></div>
        
        <div id="v-kanban" class="view"><div class="d-flex justify-content-between mb-3"><h3 class="fw-bold">Procesos</h3><button class="btn btn-light rounded-circle shadow-sm" onclick="window.loadKanban()">‚Üª</button></div><div class="row g-3 h-100"><div class="col-md-4"><div class="bg-white border rounded-3 p-3 h-100 d-flex flex-column shadow-sm"><h6 class="fw-bold text-center text-muted mb-3 border-bottom pb-2">PENDIENTE</h6><div id="k-pend" class="d-flex flex-column gap-2 pt-2"></div></div></div><div class="col-md-4"><div class="bg-white border rounded-3 p-3 h-100 d-flex flex-column shadow-sm"><h6 class="fw-bold text-center text-info mb-3 border-bottom pb-2">LAVANDO</h6><div id="k-lav" class="d-flex flex-column gap-2 pt-2"></div></div></div><div class="col-md-4"><div class="bg-white border rounded-3 p-3 h-100 d-flex flex-column shadow-sm"><h6 class="fw-bold text-center text-success mb-3 border-bottom pb-2">LISTO</h6><div id="k-list" class="d-flex flex-column gap-2 pt-2"></div></div></div></div></div>
        
        <div id="v-hist" class="view">
            <h3 class="fw-bold mb-3">Historial</h3>
            <div class="card p-3 shadow-sm border-0 mb-3">
                <div class="row g-2 align-items-end">
                    <div class="col-md-3"><label>Desde</label><input type="date" id="h-ini" class="form-control form-control-sm"></div>
                    <div class="col-md-3"><label>Hasta</label><input type="date" id="h-fin" class="form-control form-control-sm"></div>
                    <div class="col-md-4"><label>Buscar</label><input type="text" id="h-bus" class="form-control form-control-sm" placeholder="Folio..."></div>
                    <div class="col-md-2"><button class="btn btn-primary btn-sm w-100 fw-bold" onclick="window.loadHistorial()">Buscar</button></div>
                    <div class="col-12 text-end"><div class="form-check form-switch d-inline-block"><input class="form-check-input" type="checkbox" id="h-ver-canceladas" onchange="window.loadHistorial()"><label class="form-check-label small ms-2">üóëÔ∏è Ver Canceladas</label></div></div>
                </div>
            </div>
            <div class="card border-0 shadow-sm overflow-hidden"><div style="max-height:50vh;overflow:auto"><table class="table table-hover mb-0 small"><thead class="table-light sticky-top"><tr><th>Folio</th><th>Fecha</th><th>Cliente</th><th>Total</th><th>Pago</th><th>Estatus</th><th>Acci√≥n</th></tr></thead><tbody id="tblHistorial"></tbody></table></div></div>
        </div>
        
        <div id="v-inv" class="view">
            <div class="d-flex justify-content-between mb-3">
                <h3 class="fw-bold">Cat√°logo</h3>
                <button class="btn btn-primary" onclick="window.modalProd()">+ Nuevo</button>
            </div>
            <div class="card border-0 shadow-sm">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light"><tr><th>Nombre</th><th>Tipo</th><th>Precio</th><th>Stock</th><th class="text-end">Acciones</th></tr></thead>
                    <tbody id="tblInv"></tbody>
                </table>
            </div>
        </div>
        
        <div id="v-audit" class="view">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="fw-bold text-danger"><i class="bi bi-shield-lock-fill"></i> Auditor√≠a y Seguridad</h3>
                <button class="btn btn-light shadow-sm rounded-circle" onclick="window.loadAuditoria()">‚Üª</button>
            </div>
            
            <div class="card p-0 shadow-sm border-0 overflow-hidden">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" style="font-size: 0.9rem;">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center" width="15%">Fecha</th>
                                <th width="20%">Usuario</th>
                                <th width="10%">M√≥dulo</th>
                                <th width="20%">Acci√≥n</th>
                                <th width="35%">Detalles</th>
                            </tr>
                        </thead>
                        <tbody id="tblAudit"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="v-users" class="view"><h3 class="fw-bold">Equipo</h3><button class="btn btn-primary mb-3" onclick="window.modalUser()">+ Nuevo</button><table class="table"><tbody id="tblUsers"></tbody></table></div>
        <div id="v-sucs" class="view"><h3 class="fw-bold">Sucursales</h3><button class="btn btn-primary mb-3" onclick="window.modalSucursal()">+ Nuevo</button><table class="table"><tbody id="tblSucursales"></tbody></table></div>
        
        <div id="v-conf" class="view">
            <h3 class="fw-bold mb-4">Configuraci√≥n</h3>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm p-4">
                        <h5 class="fw-bold text-primary mb-3"><i class="bi bi-receipt"></i> Datos del Ticket</h5>
                        
                        <div class="mb-3">
                            <label class="small fw-bold text-muted">Encabezado (Nombre del Negocio)</label>
                            <input type="text" id="conf-header" class="form-control" placeholder="Ej. LAVANDER√çA EXPRESS">
                        </div>
        
                        <div class="row g-2 mb-3">
                            <div class="col-8">
                                <label class="small fw-bold text-muted">Direcci√≥n</label>
                                <input type="text" id="conf-dir" class="form-control" placeholder="Calle y N√∫mero">
                            </div>
                            <div class="col-4">
                                <label class="small fw-bold text-muted">Tel√©fono</label>
                                <input type="text" id="conf-tel" class="form-control" placeholder="10 d√≠gitos">
                            </div>
                        </div>
        
                        <div class="mb-3">
                            <label class="small fw-bold text-muted">Pie de P√°gina (Despedida)</label>
                            <input type="text" id="conf-footer" class="form-control" placeholder="Ej. ¬°Gracias por su preferencia!">
                        </div>
        
                        <div class="mb-3">
                            <label class="small fw-bold text-muted">Texto Legal (Condiciones)</label>
                            <textarea id="conf-legal" class="form-control" rows="3" placeholder="Ej. No nos hacemos responsables por ropa que despinta..."></textarea>
                        </div>
                    </div>
                </div>
        
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm p-4 mb-4">
                        <h5 class="fw-bold text-primary mb-3"><i class="bi bi-sliders"></i> Operaci√≥n</h5>
                        <div class="row g-2 align-items-end">
                            <div class="col-6 col-md-4">
                                <label class="small fw-bold">Precio Kilo</label>
                                <input type="number" id="conf-precio-kilo" class="form-control">
                            </div>
                            <div class="col-6 col-md-4">
                                <label class="small fw-bold">Min Kilos</label>
                                <input type="number" id="conf-min-kilos" class="form-control">
                            </div>
                            <div class="col-6 col-md-4">
                                <label class="small fw-bold">Fondo Caja</label>
                                <input type="number" id="conf-fondo" class="form-control">
                            </div>
                            <div class="col-6 col-md-6">
                                <label class="small fw-bold text-primary">D√≠as Entrega</label>
                                <input type="number" id="conf-dias-entrega" class="form-control border-primary" placeholder="2">
                            </div>
                            <div class="col-6 col-md-6">
                                <label class="small fw-bold text-danger">D√≠as Abandono</label>
                                <input type="number" id="conf-dias-abandono" class="form-control border-danger" placeholder="30">
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-3 border-top text-end">
                            <button class="btn btn-primary fw-bold w-100 py-2 shadow-sm" onclick="window.guardarConfigDB()">
                                <i class="bi bi-save"></i> GUARDAR CAMBIOS
                            </button>
                        </div>
                    </div>
        
                    <div class="card border-0 shadow-sm p-4 bg-light">
                        <h5 class="fw-bold mb-3">Impresora</h5>
                        <div class="row mb-3">
                            <div class="col-6">
                                <label>Ancho</label>
                                <select id="conf-ancho" class="form-select" onchange="window.saveLocalPrint()">
                                    <option value="58mm">58mm</option>
                                    <option value="80mm">80mm</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label>Fuente</label>
                                <input type="range" id="local-font" min="8" max="16" class="form-range" oninput="window.saveLocalPrint()">
                            </div>
                        </div>
                        <button class="btn btn-dark w-100 mb-3" onclick="window.print()">üñ®Ô∏è PROBAR IMPRESI√ìN</button>
                        <hr>
                        <button class="btn btn-outline-danger w-100 py-3 fw-bold" onclick="window.hacerCorteZ()">üîê CIERRE DE TURNO Z</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<template id="tplCobro">
    <div class="container-fluid p-0">
        <h1 class="text-center text-primary fw-bold mb-3" id="lblTotalDisplay">$0.00</h1>
        
        <div class="btn-group w-100 mb-3 shadow-sm">
            <input type="radio" class="btn-check" name="te" id="entTienda" checked onchange="window.toggleEntrega()">
            <label class="btn btn-outline-primary" for="entTienda">Tienda</label>
            <input type="radio" class="btn-check" name="te" id="entDom" onchange="window.toggleEntrega()">
            <label class="btn btn-outline-primary" for="entDom">Domicilio</label>
        </div>

        <div class="mb-3">
            <label class="small fw-bold text-muted">üìÖ Fecha y Hora de Entrega</label>
            <div class="d-flex gap-2">
                <input type="date" id="c-fecha-entrega" class="form-control form-control-lg fw-bold text-center bg-light border-primary text-primary" style="flex:1;">
                <input type="text" id="c-hora-entrega" class="form-control form-control-lg fw-bold text-center bg-light border-primary text-dark" placeholder="Ej. 3pm - 6pm" style="flex:1;">
            </div>
        </div>

        <div id="secEnvio" style="display:none" class="mb-3 card bg-light p-2 border-0">
            <input id="c-dir" class="form-control mb-2" placeholder="Direcci√≥n">
            <input id="c-costo" type="number" class="form-control" placeholder="Costo Env√≠o" onkeyup="window.calcTotal()">
        </div>

        <div class="card bg-light p-3 border-0 rounded-4">
            <label class="small fw-bold text-muted mb-2">M√âTODOS DE PAGO:</label>
            <div class="input-group mb-2">
                <span class="input-group-text bg-white border-0"><i class="bi bi-cash"></i></span>
                <input id="p-efectivo" type="number" class="form-control border-0" placeholder="Efectivo $0.00" onkeyup="window.calcPagos()">
            </div>
            <div class="input-group mb-2">
                <span class="input-group-text bg-white border-0"><i class="bi bi-credit-card"></i></span>
                <input id="p-tarjeta" type="number" class="form-control border-0" placeholder="Tarjeta $0.00" onkeyup="window.calcPagos()">
            </div>
        </div>

        <div class="alert alert-light border text-center mt-3 py-2">
            <small class="text-uppercase text-muted fw-bold">ESTADO</small>
            <h4 class="m-0 fw-bold" id="lblRestante">--</h4>
        </div>

        <div class="pt-2 text-end">
            <div class="form-check form-switch d-inline-block">
                <input class="form-check-input" type="checkbox" id="c-factura">
                <label class="form-check-label small">Factura</label>
            </div>
        </div>
        <span id="lblTotal" style="display:none">0</span>
    </div>
</template>

<template id="tplTintoreriaMass">
    <div class="container-fluid p-0">
        <div class="alert alert-info py-2 small mb-2">
            <i class="bi bi-info-circle"></i> Las prendas iguales se agrupar√°n en el ticket.
        </div>
        
        <div class="row g-2 align-items-end mb-3 bg-light p-2 rounded border">
            <div class="col-2">
                <label class="small fw-bold">Cant.</label>
                <input id="tm-qty" type="number" class="form-control form-control-sm text-center fw-bold bg-white" value="1" min="1">
            </div>
            <div class="col-4">
                <label class="small fw-bold">Prenda</label>
                <input id="tm-prenda" class="form-control form-control-sm" placeholder="Ej. Camisa">
            </div>
            <div class="col-3">
                <label class="small fw-bold">Color</label>
                <input id="tm-color" type="text" class="form-control form-control-sm" placeholder="Azul">
            </div>
            <div class="col-3">
                <label class="small fw-bold">Detalle</label>
                <div class="input-group input-group-sm">
                    <input id="tm-detalles" class="form-control" placeholder="...">
                    <button class="btn btn-primary fw-bold" onclick="window.addMassItem()">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="border rounded overflow-hidden" style="height: 200px; overflow-y: auto;">
            <table class="table table-sm table-striped mb-0 small align-middle">
                <thead class="table-dark sticky-top">
                    <tr><th width="15%" class="text-center">Cant.</th><th>Prenda</th><th>Color</th><th></th></tr>
                </thead>
                <tbody id="tm-lista"></tbody>
            </table>
        </div>
        <div class="text-end mt-1 text-muted small">Total Prendas: <span id="tm-count" class="fw-bold text-dark">0</span></div>
    </div>
</template>

<template id="tplTintoreria">
    <div class="text-start">
        <div class="mb-3">
            <label class="small fw-bold text-muted">1. ¬øQu√© prenda es?</label>
            <input id="tin-prenda" class="form-control fw-bold" placeholder="Ej. Camisa, Vestido de Noche, Saco...">
        </div>
        <div class="mb-3">
            <label class="small fw-bold text-muted">2. Color</label>
            <div class="d-flex justify-content-center gap-3 p-2 bg-light rounded-3 border">
                <input type="color" id="tin-color-picker" class="form-control form-control-color shadow-sm w-100" value="#3b82f6" style="cursor:pointer;">
            </div>
        </div>
        <div class="mb-3">
            <label class="small fw-bold text-muted">3. Marca</label>
            <input id="tin-marca" class="form-control" placeholder="Ej. Zara, Boss...">
        </div>
        <div class="mb-3">
            <label class="small fw-bold text-muted">4. Detalles / Manchas</label>
            <textarea id="tin-detalles" class="form-control" rows="2" placeholder="Ej. Mancha de vino en la solapa..."></textarea>
        </div>
    </div>
</template>

<template id="tplArqueo">
    <div class="row g-2 align-items-center mb-1"><div class="col-4 text-end fw-bold">$500</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="500"></div></div>
    <div class="row g-2 align-items-center mb-1"><div class="col-4 text-end fw-bold">$200</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="200"></div></div>
    <div class="row g-2 align-items-center mb-1"><div class="col-4 text-end fw-bold">$100</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="100"></div></div>
    <div class="row g-2 align-items-center mb-1"><div class="col-4 text-end fw-bold">$50</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="50"></div></div>
    <div class="row g-2 align-items-center mb-1"><div class="col-4 text-end fw-bold">$20</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="20"></div></div>
    <div class="row g-2 align-items-center mb-3"><div class="col-4 text-end fw-bold">Monedas</div><div class="col-8"><input type="number" class="form-control arqueo-input" data-val="1"></div></div>
</template>

<div class="modal fade" id="modalDetalles"> <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header border-0 bg-light rounded-top-4">
                <h5 class="modal-title fw-bold" id="det-folio"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <ul id="listaDetalles" class="list-group list-group-flush"></ul>
                <div id="btnLiquidarContainer" class="p-3"></div>
            </div>
            <div class="modal-footer border-0 rounded-bottom-4">
                <button class="btn btn-danger flex-grow-1 fw-bold py-2 rounded-3 me-2" onclick="window.cancelarOrdenDesdeModal()">üóëÔ∏è CANCELAR</button>
                <button class="btn btn-dark flex-grow-1 fw-bold py-2 rounded-3" onclick="window.imprimirTicketDesdeModal()">üñ®Ô∏è TICKET</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalLiquidar"> <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title fw-bold" id="det-folio">--</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body text-center">
                <small class="text-muted fw-bold text-uppercase">Total a Pagar</small>
                <h1 id="liqMonto" class="display-4 fw-bold text-dark my-2">$0.00</h1>
                
                <div class="bg-light p-3 rounded-3 mb-3 border">
                    <label class="small fw-bold text-muted mb-1">üíµ Paga con:</label>
                    <input type="number" id="liq-recibido" class="form-control form-control-lg text-center fw-bold" placeholder="$0.00" onkeyup="window.calcCambioLiq()">
                    
                    <div class="mt-2">
                        <small class="text-muted">Cambio:</small>
                        <div id="liq-cambio" class="h4 fw-bold text-primary">$0.00</div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-success py-3 fw-bold shadow-sm" onclick="window.confirmarLiquidacion('efectivo')">
                        <i class="bi bi-cash-stack"></i> EFECTIVO
                    </button>
                    <button class="btn btn-primary py-2 fw-bold shadow-sm" onclick="window.confirmarLiquidacion('tarjeta')">
                        <i class="bi bi-credit-card-2-front"></i> TARJETA
                    </button>
                    <button class="btn btn-secondary py-2 fw-bold" onclick="window.confirmarLiquidacion('transferencia')">
                        <i class="bi bi-bank"></i> TRANSFERENCIA
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalProd"> <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">Producto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="lblProd" class="h5 text-center mb-3 fw-bold text-primary"></div>
                <div id="secPeso" style="display:none">
                    <label>Peso (Kg)</label>
                    <input type="number" id="inpPeso" class="form-control form-control-lg text-center fw-bold" step="0.1">
                </div>
                <div id="secCantidad">
                    <label>Cantidad</label>
                    <input type="number" id="inpCantidadModal" class="form-control form-control-lg text-center fw-bold" value="1">
                </div>
                <button class="btn btn-primary w-100 py-3 mt-3 fw-bold rounded-3" onclick="window.addCart()">AGREGAR</button>
            </div>
        </div>
    </div>
</div>

<script src="app.js?v=2"></script>
</body>
</html>